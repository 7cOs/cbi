.total-opportunities
  h4.opportunities-count(ng-if="!list.opportunitiesService.model.filterApplied" ng-hide="list.opportunitiesService.model.filterApplied || list.opportunitiesService.model.opportunities.length !== 0") 0 opportunities <span>across 0 stores</span>
  h4.opportunities-count(ng-if="list.pageName(['accounts']) || list.pageName(['target-list-detail'])" ng-hide="list.opportunitiesService.model.noOpportunitiesFound || !list.opportunitiesService.model.filterApplied") {{list.filtersService.model.appliedFilter.pagination.totalOpportunities | number:0 }} opportunities <span>across {{list.filtersService.model.appliedFilter.pagination.totalStores | number:0}} stores</span>
  span.opportunities-selected-count(ng-hide="!list.selected || list.selected.length === 0")
    ng-pluralize(count="list.selected.length" when="{'1' : '1 opportunity selected', 'other': '{{list.selected.length}} opportunities selected'}")

.action-buttons
  span(ng-switch="list.selected < 1")
    span(ng-switch-when="true")
      button.btn-action(ng-if="!list.targetListService.model.currentList.archived && list.pageName(['target-lists', 'target-list-detail'])" ng-disabled="true") Add to Target List
      button.btn-action(ng-if="!list.targetListService.model.currentList.archived && list.pageName(['opportunities'])" ng-disabled="true") Copy to Target List
      button.btn-action(ng-if="list.targetListService.model.currentList.archived" ng-disabled="true") Download
      button.btn-action(ng-if="!list.targetListService.model.currentList.archived && list.pageName(['opportunities'])" ng-disabled="true" ) Remove


    span(ng-switch-when="false")
      md-menu(md-offset="0 45" ng-if="list.pageName(['target-lists', 'target-list-detail'])")
        button.btn-action(aria-label="Add to Target List" ng-click="$mdOpenMenu($event)" analytics-on="click" analytics-event="Add Opportunity") Add to Target List
        md-menu-content.target-list-menu
          md-menu-item(ng-click="list.createNewList($event)")
            p Create New List
          md-menu-item(ng-repeat="targetList in list.userService.model.targetLists.owned | filter:{archived:false, deleted: false}" ng-click="list.addToTargetList(targetList.id)")
            p {{::targetList.name}}
      md-menu(md-offset="0 45" ng-if="list.pageName(['opportunities']) && !list.targetListService.model.currentList.archived")
        button.btn-action(ng-click="$mdOpenMenu($event)" analytics-on="click" analytics-event="Add to Target List") Copy to Target List
        md-menu-content.target-list-menu
          md-menu-item(ng-repeat="targetList in list.userService.model.targetLists.owned" ng-click="list.addToTargetList(targetList.id)")
            p {{::targetList.name}}
      md-menu(md-offset="0 45")
        button.btn-action(ng-click="$mdOpenMenu($event)" ng-disabled="list.selected < 1") Download
        md-menu-content.target-list-menu
          md-menu-item(ng-csv="list.flattenOpportunity(list.selected, true)" filename="{{list.getDate() | date:'yyyy-MM-dd'}}.csv" csv-header="list.csvHeaderRationale" ng-click="$mdCloseMenu($event)")
            p With Rationale
          md-menu-item(ng-csv="list.flattenOpportunity(list.selected)" filename="{{list.getDate() | date:'yyyy-MM-dd'}}.csv" csv-header="list.csvHeader" ng-click="$mdCloseMenu($event)")
            p Without Rationale
      button.btn-action(ng-disabled="list.selected < 1" ng-click="list.removeOpportunity()" ng-if="list.pageName(['opportunities']) && !list.targetListService.model.currentList.archived") Remove

button.icon.select-all(ng-click="list.toggleSelectAllStores()") {{!list.isSelectAllActivated ? 'Select All' : 'Un-Select All'}}
button.icon.narrow-icon.expand-all(ng-click="list.accordion.expandAll()" ng-disabled="list.allOpportunitiesExpanded()") Expand All
button.icon.narrow-icon.collapse-all(ng-click="list.accordion.collapseAll()" ng-disabled="list.noOpportunitiesExpanded()") Collapse All
p.list-disabled-message {{::list.disabledMessage}}

v-accordion.styled-list(multiple="" id="opportunities" control="list.accordion" onexpand="list.expandCallback(item)" oncollapse="list.collapseCallback(item)" column='12' )
  div.header-row(row ng-class="{'header-disabled': list.filtersService.model.appliedFilter.pagination.totalOpportunities === 0}")
    div.checkbox-wrapper.placeholder
    div.hide-wrapper(ng-if="list.pageName()")
      label
    div.more-wrapper(ng-if="!list.pageName()")
    div.checkbox-sibling(column='12')
      div(column='3')
        label(ng-click="list.sortBy('store');" ng-class="{ 'header-bold' : list.filtersService.model.appliedFilter.sort.sortArr[0].str === 'store' || list.orderName[0] === 'store.name' || list.orderName[0] === '-store.name'}").sort
          | Store / Number
          span(ng-class="{'chevron-up-small' : (list.filtersService.model.appliedFilter.sort.sortArr[0].asc && list.filtersService.model.appliedFilter.sort.sortArr[0].str === 'store') || list.ascending && list.orderName[0] === 'store.name'}").chevron-down-small
      div(column='4')
        label Address
      div.text-center(column='2')
        label(ng-click="list.sortBy('opportunity');" ng-class="{'header-bold': list.filtersService.model.appliedFilter.sort.sortArr[0].str === 'opportunity' || list.orderName[0] === '-groupedOpportunities.length'}").sort Opportunities
          span.chevron-down-small
      div(column='1')
        label(ng-click="list.sortBy('depletions');" ng-class="{ 'header-bold' : list.filtersService.model.appliedFilter.sort.sortArr[0].str === 'depletions' || list.orderName[0] === 'store.depletionsCurrentYearToDate' || list.orderName[0] === '-store.depletionsCurrentYearToDate'}").sort
          | Depletions CYTD
          span(ng-class="{'chevron-up-small' : (list.filtersService.model.appliedFilter.sort.sortArr[0].asc && list.filtersService.model.appliedFilter.sort.sortArr[0].str === 'depletions') || list.ascending && list.orderName[0] === 'store.depletionsCurrentYearToDate'}").chevron-down-small
      div(column='1')
        label vs Ya%
      div(column='1')
        label(ng-click="list.sortBy('segmentation');" ng-class="{ 'header-bold' : list.filtersService.model.appliedFilter.sort.sortArr[0].str === 'segmentation' || list.orderName[0] === 'store.segmentation' || list.orderName[0] === '-store.segmentation'}").sort
          | Segmentation
          span(ng-class="{'chevron-up-small' : (list.filtersService.model.appliedFilter.sort.sortArr[0].asc && list.filtersService.model.appliedFilter.sort.sortArr[0].str === 'segmentation') || list.ascending && list.orderName[0] === 'store.segmentation'}").chevron-down-small
  div(ng-if="!list.opportunitiesService.model.filterApplied && list.opportunitiesService.model.opportunities.length === 0").no-opportunities
    h4 To get started, select some filters!
    p Narrow your opportunities by selecting a <strong>Retailer</strong> and/or a <strong>Distributor</strong>.
  div(ng-if="list.opportunitiesService.model.noOpportunitiesFound === true && list.opportunitiesService.model.filterApplied").no-opportunities.filter-error
    h4 Dang! We were unable to find any opportunities that met your criteria.
    p Try adjusting your filters to broaden your search!
  v-pane.list-item(row ng-repeat="opportunity in list.opportunitiesService.model.opportunities | filter : {'dismissed': false} | orderBy : list.orderName" expanded='opportunity.isExpanded')
    .shadow-wrap.bottom
      .header-wrapper(ng-click="list.toggleOpportunitiesInStores(opportunity, list.selected)")
        div.checkbox-wrapper(ng-click="list.toggleOpportunitiesInStores(opportunity, list.selected)")
          md-checkbox(aria-label="Select Item" ng-click="list.toggleOpportunitiesInStores(opportunity, list.selected)" ng-checked="opportunity.selectedOpportunities === opportunity.groupedOpportunities.length")
        v-pane-header.checkbox-sibling(column='12' ng-click="$event.stopPropagation()")
          div(ng-class="{long: opportunity.store.name.length > 21}").cell-parent
            div.pad-cell.semi-bold(column='3') {{::opportunity.store.name | titlecase}} <span class="supporting-text" ng-if="opportunity.store.storeNumber">\#{{::opportunity.store.storeNumber | uppercase}}</span>
            div.address(column='4') {{::opportunity.store.streetAddress | titlecase}} {{::opportunity.store.city | titlecase}}, {{::opportunity.store.state}} {{::opportunity.store.zip | zipcode}}
            .text-center.semi-bold(column='2') {{opportunity.groupedOpportunities.length}} <span class="supporting-text">({{opportunity.store.highImpactOpportunityCount}} High)</span>
            .text-center.semi-bold(column='1') {{::opportunity.store.depletionsCurrentYearToDate | number: 0 }}
            .text-center.semi-bold(column='1' ng-class="list.depletionsVsYaPercent(opportunity) <= 0 ? 'negative' : 'positive'") {{::list.depletionsVsYaPercent(opportunity)| number: 1}}%
            .text-center.semi-bold(column='1') {{::opportunity.store.segmentation}}
      v-pane-content(column='12' class="products" ng-class="{'open' : open}")
        .shadow-wrap.top
          .hero-row(row)
            div(column='3').pad-cell.brand-icons
              div
                img(ng-if='list.displayBrandIcon(opportunity.brands, "corona extra")' src='assets/img/brands/brand-lg-coronaextra.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "corona light")' src='assets/img/brands/brand-lg-coronalite.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "modelo especial")' src='assets/img/brands/brand-lg-modelo.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "modelo chelada")' src='assets/img/brands/brand-lg-modelochelada.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "modelo light")' src='assets/img/brands/brand-lg-modelolite.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "negra modelo")' src='assets/img/brands/brand-lg-negramodelo.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "pacifico")' src='assets/img/brands/brand-lg-pacifico.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "pacifico light")' src='assets/img/brands/brand-lg-pacificolite.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "tecate")' src='assets/img/brands/brand-lg-tecate.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "victoria")' src='assets/img/brands/brand-lg-victoria.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "ballast point")' src='assets/img/brands/brand-lg-ballastpoint.svg')
                img(ng-if='list.displayBrandIcon(opportunity.brands, "unknown")' src='assets/img/brands/brand-lg-unknown.svg')
              div.small-icons
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "corona extra")' src='assets/img/brands/brand-sm-coronaextra.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "corona light")' src='assets/img/brands/brand-sm-coronalite.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "modelo especial")' src='assets/img/brands/brand-sm-modelo.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "modelo chelada")' src='assets/img/brands/brand-sm-modelochelada.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "modelo light")' src='assets/img/brands/brand-sm-modelolite.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "negra modelo")' src='assets/img/brands/brand-sm-negramodelo.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "pacifico")' src='assets/img/brands/brand-sm-pacifico.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "pacifico light")' src='assets/img/brands/brand-sm-pacificolite.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "tecate")' src='assets/img/brands/brand-sm-tecate.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "victoria")' src='assets/img/brands/brand-sm-victoria.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "ballast point")' src='assets/img/brands/brand-sm-ballastpoint.svg')
                img(ng-if='!list.displayBrandIcon(opportunity.brands, "unknown")' src='assets/img/brands/brand-sm-unknown.svg')

            div(column='3').no-pad
              label.bold Distribution L90
              div(row)
                div(column='6')
                  label Simple
                  div(row)
                    div(column='12') {{::opportunity.store.distributionL90Simple | number:0}}
                      span.percentage {{list.vsYAGrowthPercent(opportunity.store.distributionL90Simple, opportunity.store.distributionL90SimpleYA) | number:1}}%
                div(column='6').effective
                  label Effective
                  div(row)
                    div(column='12') {{::opportunity.store.distributionL90Effective | number:0}}
                      span.percentage {{list.vsYAGrowthPercent(opportunity.store.distributionL90Effective, opportunity.store.distributionL90EffectiveYA) | number:1}}%
            div(column='2')
              .tooltip-wrap
                label Velocity (VS YA%)
                  .tooltip
                    img(src="../assets/img/icons/help-tooltip.svg")
                    md-tooltip(md-direction="bottom")
                      label Opportunity List
                      h3 vs YA %
                      p Monthly velocity for this account, calculated by taking the total volume over the selected time period (e.g. L90) and dividing by number of 30 day periods (3). “% vs YA” indicates the trend of velocity this year vs. same time period last year.
              div(row)
                div(column='12') {{::opportunity.store.velocity | number:0}}
                  span.percentage {{list.vsYAGrowthPercent(opportunity.store.velocity, opportunity.store.velocityYA) | number:1}}%
            div(column='2')
              label Distributor
              div(row)
                div(column='12') {{::opportunity.store.distributors[0]}}
                  md-tooltip
                    div(class="align-left" ng-repeat="d in opportunity.store.distributors track by $index") {{::d}}
            div(column='2')
              a(ui-sref="accounts({id: opportunity.store.id})" ui-sref-active="active" target="_blank").details-link.accent Full Details
        .title-row(row)
          div(column='1') &nbsp;
          div(column='2')
            label.bold Product
          div(column='2')
            label.bold Type
          div(column='4')
            label.bold Rationale
          div(column='1')
            label.bold Status
          div(column='1')
            label.bold.text-center Impact
          div(column='1')
            label.bold.text-center
        v-accordion(multiple class="nested-accordion" row)
          v-pane.styled-list(ng-repeat="product in opportunity.groupedOpportunities | orderBy: [list.impactSort, 'product.name'] : false | filter : {'dismissed': false}")
            v-pane-header
              .action-overlay(ng-class="{'active': (list.opportunityShared || list.opportunityDismissTrigger) && product.id === list.currentOpportunityId, 'fail': list.shareOpportunityFail && product.id === list.currentOpportunityId}" ng-click="$event.stopPropagation()")
                div.checkbox-wrapper
                  md-checkbox(aria-label="Action Item Select" ng-checked="true")
                div.overlay-wrapper
                  p(ng-if="list.opportunityShared") Opportunity Sent!
                  p(ng-if="list.opportunityDismissTrigger") Opportunity {{product.type.toUpperCase() !== 'CUSTOM' ? 'Dismissed' : 'Closed'}}! &nbsp;
                    a(ng-click="list.opportunityDismissTrigger = false; list.undoClicked = true") UNDO
                  p(ng-if="list.shareOpportunityFail") Whatever you just tried didn't work
                div(ng-if="list.opportunityShared || list.shareOpportunityFail" ng-click="list.currentOpportunityId = ''").hide-wrapper.hide-icon-wrapper.hide-row
              div.cell-parent.sub-item(row)
                .sub-item-select(column='1' ng-class="{'flag-yellow': product.featureTypeCode === null && list.showItemAuthorizationFlag(product.itemAuthorizationCode, product.depletionsCurrentYearToDate), 'flag-green': product.featureTypeCode !== null && product.itemAuthorizationDesc === null, 'flag-both': product.featureTypeCode !== null && list.showItemAuthorizationFlag(product.itemAuthorizationCode, product.depletionsCurrentYearToDate)}")
                  md-checkbox(aria-label="Select Item" ng-click="list.selectOpportunity($event, opportunity, product, list.selected);" ng-checked="product.selected")
                div(column='2').pad-cell
                  span.product-title {{::product.product.brand}} <br>
                  | {{::product.product.name}}
                div.type(column='2') {{list.opportunityTypeOrSubtype(product) | formatOpportunitiesType}}
                div(column='4') {{::product.rationale}}
                div(column='1') {{product.status | titlecase}}
                div(column='1' class="impact {{product.impactDescription | lowercase}}")
                div(column='1').bottom.dismiss-product
                  div.more-wrapper
                    md-menu(md-position-mode="target-right target")
                      md-button.md-icon-button(aria-label="More" md-menu-origin ng-click="$mdOpenMenu($event)")
                        .more-icon
                      md-menu-content(width="4")
                        md-menu-item
                          p(ng-click="list.openShareModal(product.id); $pane.collapse()") Send To
                        md-menu-item(ng-show="product.status.toUpperCase() !== 'TARGETED' && product.type.toUpperCase() !== 'CUSTOM'")
                          p(ng-click="list.openDismissModal(product.id); $pane.collapse()") Dismiss
                        md-menu-item(ng-show="product.type.toUpperCase() === 'CUSTOM' && product.status.toUpperCase() !== 'TARGETED'")
                          p(ng-click="list.closeOrDismissOpportunity(product.id, {}, false); $pane.collapse()") Close
            .shadow-wrap.top
              v-pane-content.depletion-details
                div(row)
                  div(column="1") &nbsp;
                  div(column="4").pad-cell.more
                    label Last Depletion
                    span(ng-if='product.lastDepletionDate === null') &ndash;
                    span.last-depletion(ng-if='product.lastDepletionDate !== null') {{::product.lastDepletionDate | timeAgo: 'daysOnly' }} <span class="depletion-date">{{::product.lastDepletionDate | date:'MM/dd/yy':'UTC'}}</span>
                  div(column="2")
                    label Depletions CYTD
                    span.last-depletion {{::product.depletionsCurrentYearToDate | number:0 }}
                  div(column="1").vs-ya
                    label vs YA %
                    span(ng-if="product.depletionsCurrentYearToDateYAPercent !== 0" class='positive' ng-class="{'negative': product.depletionsCurrentYearToDateYAPercentNegative}") {{::product.depletionsCurrentYearToDateYAPercent}}
                    span(ng-if="product.depletionsCurrentYearToDateYAPercent === 0") 0%
                  div(column="2" ng-if="product.itemAuthorizationCode !== null")
                    label Authorization Type
                    span(ng-click="list.showOpportunityMemoModal(); list.getMemos(product.store.id, product.product.id, 'Item Authorization')").open-memo ({{::product.itemAuthorizationCode}}) {{::product.itemAuthorizationDesc}}
                  div(column="2" ng-if="product.featureTypeCode !== null")
                    label Feature Type
                    span(ng-click="list.showOpportunityMemoModal(); list.getMemos(product.store.id, product.product.id, 'Feature')").open-memo ({{::product.featureTypeCode}}) {{::product.featureTypeDesc}}
page
