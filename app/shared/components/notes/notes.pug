div.modal.notes(ng-if="notesOpen")
  div.title
    a.hide-row(ng-click="n.notesClose()")
    h4 {{::n.storeName | titlecase}}
  div.no-notes(ng-if="n.notes.length <= 0 && !n.loading" ng-hide="n.creatingNote")
    h5 There are no notes for this <br />account yet.
    button(ng-click="n.openCreateNote()").btn-action + Add A New Note
    br
    img(src="../assets/img/icons/no-notes.svg").no-notes-image
  div(ng-if="n.loading").progress-container
    md-progress-circular(ng-if="n.loading" md-mode="indeterminate" md-diameter="100").md-accent
    h5 Loading...

  div(ng-if="n.fileUploading").progress-container.uploader
    md-progress-circular(ng-if="n.fileUploading" md-mode="indeterminate" md-diameter="100").md-accent
    h5 Uploading Files...
  div.note-container(ng-if="n.notes.length > 0 && !n.fileUploading || n.creatingNote")
    div.new-note
      p(ng-click="n.openCreateNote()").bold.add-note <span>+</span> New Note
      div(ng-if="n.creatingNote").create-new-note
        label Topic
        label.error(ng-if="n.invalidCreateNote") Please Select a Topic
        .dropdown-filter
          .dropdown
            md-select(ng-model="n.newNote.title" ng-change="n.invalidCreateNote = false" aria-label="rationale dropdown" placeholder="Select a topic").short
              md-option(ng-repeat="topic in n.noteTopics" aria-label="note title selector" value="{{topic}}") {{topic}}
              md-option(aria-label="note title selector" value="") + Add a new topic >
        input(ng-if="n.newNote.title === '' || n.newNote.title && n.noteTopics.indexOf(n.newNote.title) === -1" ng-model="n.newNote.title")
        label details
        div.text-editor
          text-angular(ta-toolbar="[['bold','italics', 'underline', 'ul']]" ta-text-editor-class="form-content" ng-model="n.newNote.body").text-editor
        div
          .add-attachments(ngf-select="n.uploadFiles($files)" multiple ngf-pattern=".docx,.doc,.ppt,.pptx,.xls,.xlsx,.gif,.jpg,.png,.pdf")
            a(href="#").accent Add an attachment
            p {{n.errorMsg}}
        button(ng-click="n.createNote(n.newNote)").btn-action Save
        p(ng-click="n.cancelNewNote(n.newNote)").cancel.accent X Cancel
      div.inline-container(ng-if="n.newNote.attachments.length > 0")
        .attachments
          p.accent Attachments (save to upload)
      ul.note-attachments
        li(ng-repeat="attachment in n.newNote.attachments")
          div.attached-files
            .other
              p(ng-if="attachment.name").file-name {{attachment.name}}&nbsp;({{attachment.size}})
    div.note-body(id="{{note.id}}" ng-repeat="note in n.notes | orderBy:'-date'")
      div(ng-if="note.deleteConfirmation").delete-confirm
        h4 Are you sure you want to delete this note?
        div.buttons
          button(ng-click="n.deleteNote(note)").btn-action Yes
          p(ng-click="n.toggleDelete(note)").cancel.accent X Cancel
      div.note-body-field(ng-if="!note.deleteConfirmation")
        h4(ng-if="!note.editMode") {{note.title}}
        p(ng-if="!note.editMode" class="note-body-field-content" ng-class="{'expanded': note.readMore}" long-note) <div.note-body-field-text ta-bind ng-model="note.body"></div> <span class="read-more" ng-if="!note.editMode && !note.noteDetails" ng-class="{'expanded': note.readMore}" ng-click="n.readMore(note)")>...Read More</span>
        div.notes-editing(ng-if="note.editMode")
          div.main-note-section
            div
              label Topic
              label.error(ng-if="note.invalidNote") Please Select a Topic
              .dropdown-filter
                .dropdown
                  md-select(ng-model="note.title" ng-change="note.invalidNote = false" aria-label="rationale dropdown" placeholder="Select a topic").short
                    md-option(aria-label="note title selector" value="{{option}}" ng-model="note.title" ng-repeat="option in n.noteTopics") {{option}}
                    md-option(aria-label="note title selector" value="" ng-click="n.showInput()") + Add a new topic >
              input(ng-if="n.noteTopics.indexOf(note.title) === -1" ng-model="note.title")

            label Details
            div.text-editor
              text-angular(ta-toolbar="[['bold','italics', 'underline', 'ul']]" ng-model="note.body").text-editor
            div
              .add-attachments(ng-if="note.author === 'Me'" ngf-select="n.uploadFiles($files, note.id)" multiple ngf-pattern=".docx,.doc,.ppt,.pptx,.xls,.xlsx,.gif,.jpg,.png,.pdf")
                p Add an attachment
                label.error {{n.errorMsg}}
            button(ng-click="n.saveEditedNote(note)").btn-action Save
            p(ng-click="n.isEditing(note, true)").cancel.accent X Cancel
        div.inline-container(ng-if="note.attachments.length > 0")
          .attachments
            p.accent Attachments
        ul.note-attachments
          li(ng-repeat="attachment in note.attachments")
            div.attached-files(ng-switch="attachment.fileType")
              //- I have to repeat the same code because no multiple 'ng-switch-when' conditions before Angular 1.5.10 :(
              .photo(ng-switch-when="image/gif")
                img.thumbnail(src="../assets/img/icons/download-img.svg")
                a(href="{{attachment.url}}" target="_blank")
                  p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
                div(ng-click="n.showImage(attachment)" ng-class="{'chevron-down': !attachment.visible, 'chevron-up': attachment.visible}")
                .loader-wrap.inline(image-loader ng-if="attachment.visible" class="active")
                  loader
                  img(src="{{attachment.url}}")
              .photo(ng-switch-when="image/jpeg")
                img.thumbnail(src="../assets/img/icons/download-img.svg")
                a(href="{{attachment.url}}" target="_blank")
                  p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
                div(ng-click="n.showImage(attachment)" ng-class="{'chevron-down': !attachment.visible, 'chevron-up': attachment.visible}")
                .loader-wrap.inline(image-loader ng-if="attachment.visible" class="active")
                  loader
                  img(src="{{attachment.url}}")
              .photo(ng-switch-when="image/png")
                img.thumbnail(src="../assets/img/icons/download-img.svg")
                a(href="{{attachment.url}}" target="_blank")
                  p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
                div(ng-click="n.showImage(attachment)" ng-class="{'chevron-down': !attachment.visible, 'chevron-up': attachment.visible}")
                .loader-wrap.inline(image-loader ng-if="attachment.visible" class="active")
                  loader
                  img(src="{{attachment.url}}")
              .spreadsheet(ng-switch-when="application/vnd.ms-excel")
                img.thumbnail(src="../assets/img/icons/download-xls-c.svg")
                p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
              .pdf(ng-switch-when="application/pdf")
                img.thumbnail(src="../assets/img/icons/download-pdf-c.svg")
                p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
              .powerpoint(ng-switch-when="application/vnd.ms-powerpoint")
                img.thumbnail(src="../assets/img/icons/download-ppt-c.svg")
                p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
              .zip(ng-switch-when="application/zip")
                img.thumbnail(src="../assets/img/icons/download-zip-c.svg")
                p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
              .document(ng-switch-when="application/msword")
                img.thumbnail(src="../assets/img/icons/download-doc-c.svg")
                p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
              .other(ng-switch-default)
                img.thumbnail(src="../assets/img/icons/download-other-c.svg")
                p.file-name {{attachment.fileName}}&nbsp;({{attachment.fileSize}})
        .note-body-footer(ng-if="!note.editMode")
          p by <span class="note-author"> {{note.author}}</span>  <span class="note-date">{{note.date | date:"dd MMMM, yyyy 'at' h:mm a"}}</span>
          .icons
            .delete-note(ng-if="note.author === 'Me'" ng-click="n.toggleDelete(note)")
            .edit-note(ng-if="note.author === 'Me'" ng-click="n.isEditing(note)" ng-class="{'edit-note': !note.editMode, 'edit-note-active': note.editMode}")
            .email-note(ng-click="n.mailNote(note)" analytics-on="click" analytics-event="Actions" analytics-category="{{n.analyticsCategory}}" analytics-label="Email")
